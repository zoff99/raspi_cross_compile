machine:
  timezone:
    Europe/Berlin
  environment:
    MAKEFLAGS: "j4"
    _PATH: "/home/ubuntu/cc/tools/arm-bcm2708/arm-rpi-4.9.3-linux-gnueabihf/bin:/home/ubuntu/cc/tools/arm-bcm2708/arm-rpi-4.9.3-linux-gnueabihf/arm-linux-gnueabihf/bin:$PATH"
    _SYSROOT_: "/home/ubuntu/cc/tools/arm-bcm2708/arm-rpi-4.9.3-linux-gnueabihf/arm-linux-gnueabihf/sysroot"
    TOOL_PREFIX: arm-linux-gnueabihf
    _TARGET_: arm-linux-gnueabi
    _CXX: $TOOL_PREFIX-g++
    _AR: $TOOL_PREFIX-ar
    _RANLIB: $TOOL_PREFIX-ranlib
    _CC: $TOOL_PREFIX-gcc
    _LD: $TOOL_PREFIX-ld
    _PKG_CONFIG_PATH: ~/pipkgcfg
    _s_: "/home/ubuntu/src/"
dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install build-essential libtool autotools-dev automake git

    - mkdir ~/cc/
    - cd ~/cc ; git clone https://github.com/raspberrypi/tools
    - cd ~/cc/tools/ ; git checkout d820ab9c21969013b4e56c7e9cba25518afcdd44

    #- mkdir ~/rasp_sysroot/
    #- cd ~/rasp_sysroot/ ; git clone https://github.com/sdhibit/docker-rpi-raspbian
    #- cd ~/rasp_sysroot/docker-rpi-raspbian/ ; git checkout b05275e230317417b7575790789707c21cc639c1
    #- cd ~/rasp_sysroot/docker-rpi-raspbian/ ; xz -dv raspbian.*.xz ; mkdir sysroot ; cd sysroot ; tar -xvf ../raspbian.*.tar
    #- cd ~/rasp_sysroot/docker-rpi-raspbian/ ; ls -al ; ls -al sysroot

    - mkdir -p "$_PKG_CONFIG_PATH"
    - ls -al "$_SYSROOT_"
    - mkdir -p $_s_

    - echo 'export PATH="$_PATH";export PKG_CONFIG_PATH="$_PKG_CONFIG_PATH";export CC="$_CC";export CXX="$_CXX";export AR="$_AR";export RANLIB="$_RANLIB";export LD="$_LD"' > ~/pp
    - chmod u+x ~/pp

compile:
  override:
    - . ~/pp;type -a arm-linux-gnueabihf-g++
    - . ~/pp;type -a arm-linux-gnueabihf-gcc
    - . ~/pp;arm-linux-gnueabihf-g++ -v
    - . ~/pp;arm-linux-gnueabihf-gcc -v


    - . ~/pp;cd $_s_;git clone --depth=1 --branch=v1.3.0 https://github.com/yasm/yasm.git
    - . ~/pp;cd $_s_/yasm/;autoreconf -fi
    - . ~/pp;rm -Rf ~/build/
    - . ~/pp;mkdir -p ~/build/
    - . ~/pp;cd ~/build/;$_s_/yasm/configure --prefix="$_SYSROOT"/usr --disable-shared --disable-soname-versions --with-sysroot="$_SYSROOT_" --host="$_TARGET_"
    - . ~/pp;cd ~/build/;make -j4
    - . ~/pp;cd ~/build/;make install

    - . ~/pp;cd $_s_;git clone --depth=1 --branch=v1.6.0 https://github.com/webmproject/libvpx.git
    - . ~/pp;rm -Rf ~/build/
    - . ~/pp;mkdir -p ~/build/
    - . ~/pp;cd ~/build/;$_s_/libvpx/configure --prefix="$_SYSROOT"/usr --target="$_TARGET_" --disable-examples --disable-unit-tests
    - . ~/pp;cd ~/build/;make -j4
    - . ~/pp;cd ~/build/;make install


    - . ~/pp;cd $_s_;git clone --depth=1 --branch=v1.1.3 https://github.com/xiph/opus.git
    - . ~/pp;cd $_s_/opus/;autoreconf -fi
    - . ~/pp;rm -Rf ~/build/
    - . ~/pp;mkdir -p ~/build/
    - . ~/pp;cd ~/build/;$_s_/opus/configure --prefix="$_SYSROOT"/usr --disable-shared --disable-soname-versions --target="$TOOL_PREFIX" --with-sysroot="$_SYSROOT_"
    - . ~/pp;cd ~/build/;make -j4
    - . ~/pp;cd ~/build/;make install
    
    
    - . ~/pp;cd $_s_;git clone --depth=1 --branch=1.0.11 https://github.com/jedisct1/libsodium.git
    - . ~/pp;cd $_s_/libsodium/;autoreconf -fi
    - . ~/pp;rm -Rf ~/build/
    - . ~/pp;mkdir -p ~/build/
    - . ~/pp;cd ~/build/;$_s_/libsodium/configure --prefix="$_SYSROOT"/usr --disable-shared --disable-soname-versions --target="$TOOL_PREFIX" --with-sysroot="$_SYSROOT_" --enable-minimal --disable-pie
    - . ~/pp;cd ~/build/;make -j4
    - . ~/pp;cd ~/build/;make install
test:
  override:
    - echo dummy



